!function(e,t,i,n){function a(t,i){this.elem=t,this.$elem=e(t),this.$elem_original=this.$elem,this.options=i,this.metadata=this.$elem.data(),this._init()}Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var i=t||0,n=this.length;n>i;i++)if(this[i]===e)return i;return-1}),e.isSubstring=function(e,t){return-1!==e.indexOf(t)};!function(){var e=0;return function(t,i){clearTimeout(e),e=setTimeout(t,i)}}();Array.prototype.allValuesSame=function(e,t){for(var i=e;t>i;i++)if(this[i]!==this[e])return!1;return!0},i.querySelectorAll||(i.querySelectorAll=function(e){var n,a=i.createElement("style"),s=[];for(i.documentElement.firstChild.appendChild(a),i._qsa=[],a.styleSheet.cssText=e+"{x-qsa:expression(document._qsa && document._qsa.push(this))}",t.scrollBy(0,0),a.parentNode.removeChild(a);i._qsa.length;)n=i._qsa.shift(),n.style.removeAttribute("x-qsa"),s.push(n);return i._qsa=null,s}),i.querySelector||(i.querySelector=function(e){var t=i.querySelectorAll(e);return t.length?t[0]:null});var s={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,R0:96,R1:97,R2:98,R3:99,R4:100,R5:101,R6:102,R7:103,R8:104,R9:105,INSERT:45,CAPS_LOCK:20,NUM_LOCK:144,SCROLL_LOCK:145,BREAK:19,TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){switch(e=e.which?e.which:e){case s.LEFT:case s.RIGHT:case s.UP:case s.DOWN:return!0}return!1},isControl:function(e){var t=e.which;switch(t){case s.SHIFT:case s.CTRL:case s.ALT:return!0}return e.metaKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&123>=e}},o="snake";a.prototype={defaults:{root:"",width:600,height:600,cw:20,snakeCount:1,snakeCountAi:0,gameSpeed:20,snakeDiet:1,snakeLives:10,allowGrowing:1,allowTwine:0},lang:{textSelectAll:function(){return"Select all"}},_init:function(){this.config=e.extend({},this.defaults,this.options,this.metadata);var t=this;this.cw=this.config.cw,this.canvasWidth=this.config.width,this.canvasHeight=this.config.height,this.config.width%this.cw!=0&&(this.canvasWidth=this.config.width+(this.cw-this.config.width%this.cw)),this.config.height%this.cw!=0&&(this.canvasHeight=this.config.height+(this.cw-this.config.height%this.cw)),this.cpw=Math.floor(this.canvasWidth/this.cw),this.cph=Math.floor(this.canvasHeight/this.cw),this.timer=[],this.dh="right",this.dt="right",this.food=[],this.score,this.fallenCount,this.speed,this.level,this.paused=!1,this.game_loop=null,this.frames=0,this.rt=0,this.masks={0:{xy:[[0,1,0],[1,1,1]]},1:{xy:[[1,1],[1,1]]},2:{xy:[[1,1,0],[0,1,1]]},3:{xy:[[1,0,0],[1,1,1]]},4:{xy:[[1,1,1,1]]},5:{xy:[[1,0,1],[1,1,1]]},6:{xy:[[1,1,1],[1,0,1],[1,1,1]]},7:{xy:[[1,0,1],[1,0,1],[1,1,1]]},8:{xy:[[1,1,1],[0,1,0],[1,1,1]]},9:{xy:[[0,1,0],[1,1,1],[0,1,0]]},10:{xy:[[0,1,1],[1,1,0],[0,1,1]]},11:{xy:[[0,1,0],[0,1,0],[1,1,1]]},9:{xy:[[1,1,1,1,1]]},10:{xy:[[1,1,1,1,1,1]]},12:{xy:[[0,1,1,0],[1,1,1,1],[1,1,1,1],[0,1,1,0]]},13:{xy:[[1,1,1,1],[1,0,0,1],[1,0,0,1],[1,1,1,1]]},14:{xy:[[0,0,0,1],[0,0,1,0],[0,1,0,0],[1,0,0,0]]},15:{xy:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,0,0,0]]}},this.sl=4,this.canvasField=[],this.snake=[],this.wallArray=[],this.nextPiece=!1;var i=t.canvasWidth>t.canvasHeight?t.canvasHeight:t.canvasWidth;i-=50;var n=this.config.root+"img/",a="wrap_"+this.getRandomInt(1,99999);this.$elem.wrap("<div id='"+a+"'></div>"),a="#"+a;for(var s="<style>"+a+" .gameDiv{ position:relative; }"+a+" .canvasDiv{ background-image: url("+n+"snake.jpg);background-size: "+t.canvasWidth+"px "+t.canvasHeight+"px; position:relative; width: "+this.canvasWidth+"px; height: "+this.canvasHeight+"px;   }"+a+" .canvasDivBg{  }"+a+" .gameInfo{ position:absolute; top:0; left:0; margin-left:-85px; }"+a+" .gamePause{ cursor:pointer;  }"+a+" .gamePause:hover{ cursor:pointer; color:#FFF; background: #000; }"+a+" .player{ margin-bottom:5px; font-size:10px; width:80px; display:block; overflow:hidden; }"+a+" .infoPlayer, .points, .lives{ padding:3px; margin:3px; color: #FFF;}"+a+" .points, .lives{ font-size:8px; text-align:right; background: black;}"+a+" .pausePlayer, .destroyPlayer{ color:#FFF; cursor:pointer;margin-left:5px; }"+a+" .menu{ z-index:9999; position: absolute; margin:auto; background:orange; width: "+i+"px; height: "+i+"px; top:0; bottom:0; left:0; right:0; }"+a+" .menu .menuHead{ padding:5px 10px; background:green; color:white }"+a+" .menu .menuBody{ padding: 4% 4%;  height: 92%; width: 92%;  overflow:hidden; }"+a+" .menu .menuBodyInner{ height: 88%; width: 100%; overflow:auto;  }"+a+" .menu .menuBack{ text-align:center; padding:5px; margin: 0 auto; width:100px; background:green; color:white;  }"+a+" .menu .menuBack:hover{  cursor:pointer;}"+a+" .menu .menuHtml{  display:none;  }"+a+" .menu .menuHtml table{  margin:0;  }"+a+" .menu .menuHtml table tr{  background:none;  }"+a+" .menu .menuHtml table td{  border:none;  }"+a+" .menu .menuHtmlInner{  padding:10px 0; border-bottom:1px solid green; border-top:1px solid green; }"+a+" .menu .menuTitle:hover{  cursor:pointer; text-decoration:underline}"+a+" .menu .menuTitleActive { padding:5px 10px; background:green; color:white; }"+a+" .menu .menuTitleActive:hover {  text-decoration:none }"+a+" .menu select { height:25px; padding:2px; }"+a+" .pt{background-image:url("+n+"empty.png) !important;  float:left; width: "+this.cw+"px; height: "+this.cw+"px; background-size: "+this.cw+"px "+this.cw+"px; }"+a+" .c0{background-image:url("+n+"brick_empty.png) !important;  }"+a+" .c15{background-image:url("+n+"food/1/food1.png) !important; }"+a+" .c16{background-image:url("+n+"food/1/food2.png) !important; }"+a+" .c17{background-image:url("+n+"food/1/food3.png) !important; }"+a+" .c18{background-image:url("+n+"food/1/food4.png) !important; }"+a+" .c19{background-image:url("+n+"food/1/food5.png) !important; }"+a+" .c20{background-image:url("+n+"food/1/food6.png) !important; }"+a+" .c21{background-image:url("+n+"food/1/food7.png) !important; }"+a+" .c22{background-image:url("+n+"food/2/food8.png) !important; }"+a+" .c23{background-image:url("+n+"food/2/food9.png) !important; }"+a+" .c24{background-image:url("+n+"food/2/food10.png) !important; }"+a+" .c25{background-image:url("+n+"food/2/food11.png) !important; }"+a+" .c26{background-image:url("+n+"food/2/food12.png) !important; }"+a+" .c27{background-image:url("+n+"food/2/food13.png) !important; }"+a+" .c28{background-image:url("+n+"food/2/food14.png) !important; }",o=0;9>o;o++)s+=t.snakeCss(o,n,a);s+="</style>";var r="";return r+="<div class=gameDiv>",r+="<div class=canvasDiv>",r+="</div>",r+="<div class=gameInfo>",r+="</div>",r+="</div>",this.$elem.prepend(s),this.$elem.append(r),this.isPaused=!0,this.isRunning=!1,this.toggleMenu(),this.setLoop(this.speed),this._initEvents(),this},_parseInt:function(e){var t=parseInt(e);return t?t:!1},snakeCss:function(e,t,i){var n="";return n+=i+" .c"+e+"_1{background-image:url("+t+"snake"+e+"/body.png) !important; }"+i+" .c"+e+"_2{background-image:url("+t+"wall.jpg) !important; }"+i+" .c"+e+"_3{background-image:url("+t+"snake"+e+"/head1.png) !important; }"+i+" .c"+e+"_4{background-image:url("+t+"snake"+e+"/head2.png) !important; }"+i+" .c"+e+"_5{background-image:url("+t+"snake"+e+"/head3.png) !important; }"+i+" .c"+e+"_6{background-image:url("+t+"snake"+e+"/head4.png) !important; }"+i+" .c"+e+"_7{background-image:url("+t+"snake"+e+"/tail1.png) !important; }"+i+" .c"+e+"_8{background-image:url("+t+"snake"+e+"/tail2.png) !important; }"+i+" .c"+e+"_9{background-image:url("+t+"snake"+e+"/tail3.png) !important; }"+i+" .c"+e+"_10{background-image:url("+t+"snake"+e+"/tail4.png) !important; }"+i+" .c"+e+"_11{background-image:url("+t+"snake"+e+"/body1.png) !important; }"+i+" .c"+e+"_12{background-image:url("+t+"snake"+e+"/body2.png) !important; }"+i+" .c"+e+"_14{background-image:url("+t+"snake"+e+"/body4.png) !important; }"+i+" .c"+e+"_13{background-image:url("+t+"snake"+e+"/body3.png) !important; }"+i+" .player"+e+" {background-image:url("+t+"snake"+e+"/player.png) !important; }"},menuItem:function(e,t,i,n,a){var s="";return a=a?" "+a:"",s+="<div class='menuItem"+a+"' data-action='"+i+"'>",s+="<div class='menuTitle'>",s+=t,s+="</div>",s+=e,s+="<div class='menuHtml'>",s+="<div class='menuHtmlInner'>",s+=n,s+="</div>",s+="<div class='menuBack'>Späť</div>",s+="</div>",s+="</div>"},menuItems:function(e){for(var t="<div class='menuItems'>",i=0;i<e.length;i++){var n="";e[i].items&&e[i].items.length>0&&(n=this.menuItems(e[i].items));var a="",s="",o="";e[i].action&&(a=e[i].action),e[i].html&&(s=e[i].html),e[i].cls&&(o=e[i].cls),t+=this.menuItem(n,e[i].title,a,s,o)}return t+="</div>"},menuTpl:function(e,t,i,n){var a="";return a+="<div class='menu menu"+n+"'>",a+="<div class='menuHead'>",a+=e,i&&(a+="<div class='menuBack'>Späť</div>"),a+="</div>",a+="<div class='menuBody'>",a+="<div class='menuBodyInner'>",a+=t,a+="</div>",a+="</div>",a+="</div>"},renderSelect:function(e,t,i){var n,a,s="";s+="<select class='"+e+"'>";for(var o=0;o<t.length;o++)a=t[o].id,n="",i==a&&(n="selected"),s+="<option data-id='"+a+"' "+n+">",s+=t[o].text,s+="</option>";return s+="</select>"},toggleMenu:function(){var t=this;if(t.$elem.find(".menu").length>0)t.$elem.find(".menu").is(":hidden")?t.$elem.find(".menu").show():t.$elem.find(".menu").hide();else{for(var i=[{title:"Nová hra",action:1},{title:"Pokračovať v hre",action:2},{title:"Simulácia",action:3},{title:"Ovládanie hry",html:"<div>Hráč 1: ŠÍPKY</div> <div>Hráč 2: A S D W</div><div>Hráč 3: F G H T </div><div>Hráč 4: J K L I</div> <div>Pauza: P</div>"},{title:"Nastavenia",html:"<table class='settings'><tr><td>Počet hráčov</td> <td>"+this.renderSelect("snakeCount",[{id:1,text:1},{id:2,text:2},{id:3,text:3},{id:4,text:4},{id:5,text:5},{id:6,text:6},{id:7,text:7},{id:8,text:8}],this.config.snakeCount)+"  z toho autopilotov "+this.renderSelect("snakeCountAi",[{id:0,text:"žiadny"},{id:1,text:1},{id:2,text:2},{id:3,text:3},{id:4,text:4},{id:5,text:5},{id:6,text:6},{id:7,text:7},{id:8,text:8}],this.config.snakeCountAi)+" </td></tr><tr> <td>Počet životov</td> <td>"+this.renderSelect("snakeLives",[{id:1,text:1},{id:5,text:5},{id:10,text:10},{id:20,text:20},{id:50,text:50},{id:100,text:100},{id:1e3,text:1e3}],this.config.snakeLives)+" </td>   </tr><tr> <td>Rýchlosť hry</td> <td>"+this.renderSelect("gameSpeed",[{id:50,text:"slimačia"},{id:20,text:"pomalá"},{id:15,text:"stredná"},{id:10,text:"rýchla"},{id:5,text:"megarýchla"},{id:3,text:"urýchľovač častíc"},{id:1,text:"rýchlosť svetla"}],this.config.gameSpeed)+" </td>   </tr> <tr> <td>Diéta</td><td>"+this.renderSelect("snakeDiet",[{id:1,text:"vegetarián"},{id:2,text:"mäsožravec"},{id:3,text:"všežravec"}],this.config.snakeDiet)+" </td></tr><tr> <td>Povoliť rast</td><td>"+this.renderSelect("allowGrowing",[{id:0,text:"Nie"},{id:1,text:"Áno"}],this.config.allowGrowing)+" </td></tr><tr> <td>Povoliť zauzlenie</td><td>"+this.renderSelect("allowTwine",[{id:0,text:"Nie"},{id:1,text:"Áno"}],this.config.allowTwine)+" </td></tr></table>"}],n=t.menuItems(i),a=t.menuTpl("Hlavné menu",n,!1,0),s=0;s<i.length;s++);var o=e(a);t.$elem.find(".canvasDiv").append(o),o.hide().fadeIn(500)}t.isRunning?t.$elem.find('.menuItems .menuItem[data-action="2"]').show():t.$elem.find('.menuItems .menuItem[data-action="2"]').hide()},_initEvents:function(){var t=this;e(i).keydown(function(e){var i=e.which;if(t.isRunning&&(!t.isPaused||i==s.P)){return e.preventDefault(),"37"==i&&"right"!=t.snake[0].dh?t.snake[0].dh="left":"38"==i&&"down"!=t.snake[0].dh?t.snake[0].dh="up":"39"==i&&"left"!=t.snake[0].dh?t.snake[0].dh="right":"40"==i&&"up"!=t.snake[0].dh&&(t.snake[0].dh="down"),i==s.A&&"right"!=t.snake[1].dh?t.snake[1].dh="left":i==s.W&&"down"!=t.snake[1].dh?t.snake[1].dh="up":i==s.D&&"left"!=t.snake[1].dh?t.snake[1].dh="right":i==s.S&&"up"!=t.snake[1].dh&&(t.snake[1].dh="down"),i==s.F&&"right"!=t.snake[2].dh?t.snake[2].dh="left":i==s.T&&"down"!=t.snake[2].dh?t.snake[2].dh="up":i==s.H&&"left"!=t.snake[2].dh?t.snake[2].dh="right":i==s.G&&"up"!=t.snake[2].dh&&(t.snake[2].dh="down"),void(i==s.J&&"right"!=t.snake[3].dh?t.snake[3].dh="left":i==s.I&&"down"!=t.snake[3].dh?t.snake[3].dh="up":i==s.L&&"left"!=t.snake[3].dh?t.snake[3].dh="right":i==s.K&&"up"!=t.snake[3].dh?t.snake[3].dh="down":i==s.P&&(t.isPaused=!t.isPaused,t.toggleMenu(!0)))}}),t.$elem.on("change","select",function(){var i=e(this),n=(i.val(),i.attr("class")),a=i.find(":selected").data("id");t.config[n]=1*a}),t.$elem.on("click",".gamePause",function(){t.isPaused=!t.isPaused,t.toggleMenu(!0)}),t.$elem.on("click",".pausePlayer",function(){var i=e(this).closest(".player").data("player"),n=e(this).closest(".player").data("speed");0==t.snake[i].s?t.snake[i].s=n:(e(this).closest(".player").data("speed",t.snake[i].s),t.snake[i].s=0)}),t.$elem.on("click",".destroyPlayer",function(){var i=e(this).closest(".player").data("player");t.snake[i]={},e(this).closest(".player").fadeOut(500),t.snakeExists()||t.gameOver()}),t.$elem.on("click",".menuTitle",function(){{var i=e(this).closest(".menuItem"),n=i.data("action");i.data("html"),i.text()}n?"1"==n?(t.resetGame(),t.isPaused=!1,t.isRunning=!0):"2"==n?(t.isPaused=!1,t.toggleMenu(!0)):"3"==n&&(t.config.snakeCount=8,t.config.snakeCountAi=8,t.config.gameSpeed=1,t.config.allowGrowing=0,t.config.snakeLives=1e3,t.resetGame(),t.isPaused=!1,t.isRunning=!0):(e(".menuItem").hide(),i.show(),i.find(".menuHtml").fadeIn(500),i.find(".menuTitle").addClass("menuTitleActive"))}),t.$elem.on("click",".menuBack",function(){var i=e(this).closest(".menuItem");e(".menuItem").fadeIn(500),i.find(".menuHtml").hide(),i.find(".menuTitle").removeClass("menuTitleActive"),t.isRunning?t.$elem.find('.menuItems .menuItem[data-action="2"]').show():t.$elem.find('.menuItems .menuItem[data-action="2"]').hide()}),e(".ctrl").click(function(){var i=e(this).data("key");"37"==i?t.movePiece(-1):"39"==i?t.movePiece(1):"40"==i?t.setLoop(t.drawCanvas,1):"82"==i&&t.rotate()})},resetGame:function(){this.dh="right",this.dt="right",this.score=0,this.fallenCount=0,this.speed=60,this.level=1,this.nextPiece=!1,this.createCanvas(),this.createSnakes(),e("#level").text(this.level),e("#fallenCount").text(this.fallenCount),e("#score").text(this.score),this.createFood()},foodExists:function(e,t){for(var i=!1,n=this,a=0;a<n.food.length;a++)e==n.food[a].x&&t==n.food[a].y&&(i=a);return i},createFood:function(e,t){var i=this.getRandomInt(0,this.cpw-1),n=this.getRandomInt(0,this.cph-1);if(this.check_collision(i,n,this.wallArray.xy)||e==i&&t==n||this.foodExists(i,n))return void this.createFood(e,t);var a=15,s=28;1==this.config.snakeDiet?(a=15,s=21):2==this.config.snakeDiet&&(a=22,s=28);var o={x:i,y:n,t:this.getRandomInt(a,s)};this.food.push(o)},createCanvas:function(){var e=this;this.$elem.find(".canvasDiv").html("");for(var t=3e3,i=0;i<this.cph;i++){this.canvasField[i]=[];for(var n=0;n<this.cpw;n++)ta=0,t-=5,this.canvasField[i][n]=ta,this.$elem.find(".canvasDiv").append("<div class='pt xy_"+n+"_"+i+" x"+n+" y"+i+"' ></div>"),this.$elem.find(".xy_"+n+"_"+i).hide().fadeIn(t)}e.$elem.find(".canvasDiv").removeClass("canvasDivBg"),clearTimeout(this.timer.canvasDiv),this.timer.canvasDiv=setTimeout(function(){e.$elem.find(".canvasDiv").addClass("canvasDivBg")},3e3)},setLoop:function(){var e=this,i=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)}}();!function n(){e.isPaused||e.gameLoop(),i(n)}()},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},createSnakes:function(){this.fallenCount=this.fallenCount+1,e("#fallenCount").text(this.fallenCount);var t=4;this.fallenCount%10==0&&(this.level=this.level+1,e("#level").text(this.level),t+=Math.floor(this.fallenCount/10)),t>15&&(t=15);this.getRandomInt(0,t),this.getRandomInt(0,t),this.getRandomInt(0,3),this.getRandomInt(0,3);this.snake=[];var i=this.config.snakeCount,n=this.config.snakeCountAi,a="";a+="<div class='gamePause'>",a+="Pauza",a+="</div>";for(var s=0;i>s;s++){this.snake[s]={},this.snake[s].xy=[],this.snake[s].r=1,this.snake[s].s=this.config.gameSpeed,this.snake[s].dh="right",this.snake[s].dt="right",this.snake[s].isAlive=!0,this.snake[s].lives=this.config.snakeLives,this.snake[s].points=0,this.snake[s].ai=!1,s>=i-n&&(this.snake[s].ai=!0);for(var o=3;o>=0;o--)this.snake[s].xy.push({x:o-4,y:1+s,m:1});a+="<div class='player player"+s+"' data-player='"+s+"'>",a+="<div class='infoPlayer'>Hráč "+(s+1)+"</div>",a+="<span class='points'>"+this.snake[s].points+"</span>",a+="<span class='lives'>"+this.snake[s].lives+" </span>",a+="<div>",a+="<span class='pausePlayer'>Pause</span>",a+="<span class='destroyPlayer'>Destroy</span>",a+="</div>",a+="</div>"}this.$elem.find(".gameInfo").html(a),this.wallArray.xy=[]},gameOver:function(){var e=this;e.isPaused=!0,e.isRunning=!1,e.$elem.find(".canvasDiv").html(""),e.$elem.find(".canvasDiv").removeClass("canvasDivBg"),this.$elem.find(".gamePause").html(""),e.toggleMenu()},gameLoop:function(){var e=this;e.gameUpdate(),e.gameDraw(),e.frames++},setX:function(e,t){return"right"==t?e++:"left"==t&&e--,e==this.cpw&&(e=0),-1==e&&(e=this.cpw-1),e},setY:function(e,t){return"up"==t?e--:"down"==t&&e++,e==this.cph&&(e=0),-1==e&&(e=this.cph-1),e},aiMove:function(e,t,i){for(var n=this,a=i,s=e-this.food[0].x,o=t-this.food[0].y,r=Math.abs(s)+Math.abs(o),d=0,l=!0,h=0;h<this.food.length;h++){var c=this.food[h].x,u=this.food[h].y,m=e-c,g=t-u,f=Math.abs(m)+Math.abs(g),v=this.cpw-Math.abs(m),p=this.cph-Math.abs(g),k=v+p;if(r>f)var s=m,o=g,r=f,d=h,l=!0;if(r>k)var s=v,o=p,r=k,d=h,l=!1}return this.food[d].x==e?l?this.food[d].y>t&&"up"!=i?a="down":"down"!=i&&(a="up"):t<this.cph/2&&"down"!=i?a="up":"up"!=i&&(a="down"):this.food[d].y==t?l?this.food[d].x>e&&"left"!=i?a="right":"right"!=i&&(a="left"):e<this.cpw/2&&"right"!=i?a="left":"left"!=i&&(a="right"):l?Math.abs(o)<Math.abs(s)?0>o&&"up"!=i?a="down":"down"!=i&&(a="up"):0>s&&"left"!=i?a="right":"right"!=i&&(a="left"):Math.abs(o)<Math.abs(s)?t<this.cph/2&&"down"!=i?a="up":"up"!=i&&(a="down"):e<this.cpw/2&&"right"!=i?a="left":"left"!=i&&(a="right"),nx=n.setX(e,a),ny=n.setY(t,a),this.check_collision(nx,ny,this.wallArray.xy)&&(a=i),nx=n.setX(e,a),ny=n.setY(t,a),this.check_collision(nx,ny,this.wallArray.xy)&&("right"==a||"left"==a?a=this.check_collision(e,t+1,this.wallArray.xy)?"up":"down":("up"==a||"down"==a)&&(a=this.check_collision(e+1,t,this.wallArray.xy)?"left":"right")),a},snakeExists:function(){for(var e=this,t=!1,i=0;i<e.snake.length;i++)e.snake[i].xy&&(t=!0);return t},updateSnake:function(e){{var t=this,i=t.snake[e].xy[0].x,n=t.snake[e].xy[0].y;t.snake[e].xy[0].x,t.snake[e].xy[0].y}t.snake[e].ai&&(t.snake[e].dh=t.aiMove(i,n,t.snake[e].dh,e)),i=t.setX(i,t.snake[e].dh),n=t.setY(n,t.snake[e].dh);var a;if((a=t.check_collision(i,n,t.wallArray.xy))&&(t.snake[e].isAlive=!1,setTimeout(function(){t.snake[e].isAlive=!0,t.snake[e].lives<=0?t.snake[e]={}:(t.snake[e].lives-=1,t.$elem.find(".player"+e+" .lives").html(t.snake[e].lives)),t.snakeExists()||t.gameOver()},1e3),1==t.config.allowTwine))return!1;var s=t.foodExists(i,n);if(s!==!1){if(t.food.splice(s,1),6==t.food.t){if(t.score=t.score-1,t.score<0)return void t.init()}else t.score++;if(t.snake[e].points++,t.$elem.find(".player"+e+" .points").html(t.snake[e].points),t.config.allowGrowing)var o={x:i,y:n};else{var o=t.snake[e].xy.pop();o.x=i,o.y=n}t.score%3==0&&(t.level=t.level+1,t.speed=t.speed-10);var r=t.food.length,d=this.getRandomInt(0,2);(0==d&&0==r||r>4&&d>0)&&(d=1);for(var l=0;d>l;l++)t.createFood(i,n)}else{var o=t.snake[e].xy.pop();o.x=i,o.y=n}t.snake[e].xy.unshift(o);var h=t.snake[e].xy.length,c=t.snake[e].xy[h-1].x,u=t.snake[e].xy[h-1].y,m=t.snake[e].xy[h-2].x,g=t.snake[e].xy[h-2].y;c==m?t.snake[e].dt=g>u&&g-u==1||u==t.cph-1&&0==g?"down":"up":u==g&&(t.snake[e].dt=m>c&&m-c==1||c==t.cpw-1&&0==m?"right":"left");for(var l=0;l<t.snake[e].xy.length;l++){var f=t.snake[e].xy[l],v=1;i==f.x&&n==f.y?v=2:l==t.snake[e].xy.length-1&&(v=3)}return!1},drawSnake:function(e){for(var t=this,i=0;i<t.snake[e].xy.length;i++){var n=t.snake[e].xy[i],a=!1,s=!1;i<t.snake[e].xy.length-1&&(s=t.snake[e].xy[i+1]),i>0&&(a=t.snake[e].xy[i-1]);var o=1;if(0==i){if("right"==t.snake[e].dh)var o=3;if("left"==t.snake[e].dh)var o=5;if("up"==t.snake[e].dh)var o=6;if("down"==t.snake[e].dh)var o=4}else if(i==t.snake[e].xy.length-1)if("right"==t.snake[e].dt)var o=7;else if("left"==t.snake[e].dt)var o=9;else if("up"==t.snake[e].dt)var o=10;else if("down"==t.snake[e].dt)var o=8;if(a&&s&&n.x!=t.cpw-1&&0!=n.x&&n.y!=t.cph-1&&0!=n.y){if(n.x==s.x&&n.y==a.y&&n.x>a.x&&n.y<s.y)var o=11;if(n.x==s.x&&n.y==a.y&&n.x<a.x&&n.y<s.y)var o=14;if(n.x==a.x&&n.y==s.y&&n.x>s.x&&n.y<a.y)var o=11;if(n.x==a.x&&n.y==s.y&&n.x<s.x&&n.y<a.y)var o=14;if(n.x==a.x&&n.y==s.y&&n.x>s.x&&n.y>a.y)var o=12;if(n.x==s.x&&n.y==a.y&&n.x>a.x&&n.y>s.y)var o=12;if(n.x==a.x&&n.y==s.y&&n.x<s.x&&n.y>a.y)var o=13;if(n.x==s.x&&n.y==a.y&&n.x<a.x&&n.y>s.y)var o=13}t.snake[e].isAlive||0==i||(o=2),t.drawCell(n.x,n.y,e+"_"+o)}},gameUpdate:function(){for(var e=this,t=0;t<e.snake.length;t++)console.log(e.snake[t].s),!e.snake[t].isAlive;for(var t=0;t<e.snake.length;t++)if(e.snake[t].xy&&e.snake[t].xy[0]&&e.frames%e.snake[t].s==0&&this.snake[t].isAlive){e.updateSnake(t)}},gameDraw:function(){var e=this;e.$elem.find(".pt").removeClass(function(){for(var e="",t=this.className.split(" "),i=0;i<t.length;i++)/c\d/.test(t[i])&&(e+=t[i]+" ");return e});for(var t=0;t<e.snake.length;t++)e.snake[t].xy&&e.snake[t].xy[0]&&e.drawSnake(t);for(var t=0;t<e.wallArray.xy.length;t++){var i=e.wallArray.xy[t];e.drawCell(i.x,i.y,2)}for(var t=0;t<e.food.length;t++)e.drawCell(e.food[t].x,e.food[t].y,e.food[t].t)},drawCell:function(e,t,i){this.$elem.find(".xy_"+e+"_"+t).addClass("c"+i)},check_collision:function(e,t,i){for(var n=0;n<this.snake.length;n++)if(this.snake[n].xy&&this.snake[n].xy[0])for(var a=0;a<this.snake[n].xy.length;a++)if(this.snake[n].xy[a].x==e&&this.snake[n].xy[a].y==t)return!0;if(i)for(var n=0;n<i.length;n++)if(i[n].x==e&&i[n].y==t)return!0;return!1},get_min:function(e){for(var t=this.snake.xy[0][e],i=0;i<this.snake.xy.length;i++)t>this.snake.xy[i][e]&&(t=this.snake.xy[i][e]);return t}},e.fn[o]=function(t){var i=arguments;if(t===n||"object"==typeof t)return this.each(function(){e.data(this,"plugin_"+o)||e.data(this,"plugin_"+o,new a(this,t))});if("string"==typeof t&&"_"!==t[0]&&"init"!==t){var s;return this.each(function(){var n=e.data(this,"plugin_"+o);n instanceof a&&"function"==typeof n[t]&&(s=n[t].apply(n,Array.prototype.slice.call(i,1))),"destroy"===t&&e.data(this,"plugin_"+o,null)}),s!==n?s:this}}}(jQuery,window,document);