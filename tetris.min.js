!function(e,i,t,a){function n(i,t){this.elem=i,this.$elem=e(i),this.options=t,this.metadata=this.$elem.data(),this._init()}Array.prototype.indexOf||(Array.prototype.indexOf=function(e,i){for(var t=i||0,a=this.length;a>t;t++)if(this[t]===e)return t;return-1}),e.isSubstring=function(e,i){return-1!==e.indexOf(i)};var s=(function(){var e=0;return function(i,t){clearTimeout(e),e=setTimeout(i,t)}}(),function(){return function(i,a,n){var s;e(t).on("mousedown",i,function(){var i=e(this);s=setInterval(function(){a(i)},n)}),e(t).on("mouseup",i,function(){clearInterval(s)})}}());Array.prototype.allValuesSame=function(e,i){for(var t=e;i>t;t++)if(this[t]!==this[e])return!1;return!0},t.querySelectorAll||(t.querySelectorAll=function(e){var a,n=t.createElement("style"),s=[];for(t.documentElement.firstChild.appendChild(n),t._qsa=[],n.styleSheet.cssText=e+"{x-qsa:expression(document._qsa && document._qsa.push(this))}",i.scrollBy(0,0),n.parentNode.removeChild(n);t._qsa.length;)a=t._qsa.shift(),a.style.removeAttribute("x-qsa"),s.push(a);return t._qsa=null,s}),t.querySelector||(t.querySelector=function(e){var i=t.querySelectorAll(e);return i.length?i[0]:null});var r={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,R0:96,R1:97,R2:98,R3:99,R4:100,R5:101,R6:102,R7:103,R8:104,R9:105,INSERT:45,CAPS_LOCK:20,NUM_LOCK:144,SCROLL_LOCK:145,BREAK:19,TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){switch(e=e.which?e.which:e){case r.LEFT:case r.RIGHT:case r.UP:case r.DOWN:return!0}return!1},isControl:function(e){var i=e.which;switch(i){case r.SHIFT:case r.CTRL:case r.ALT:return!0}return e.metaKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&123>=e}},o="tetris";n.prototype={defaults:{width:400,height:500,cw:31,gameSpeed:50,root:""},lang:{textSelectAll:function(){return"Select all"}},_init:function(){this.config=e.extend({},this.defaults,this.options,this.metadata);var i=this;this.cw=this.config.cw,this.canvasWidth=this.config.width,this.canvasHeight=this.config.height,this.config.width%this.cw!=0&&(this.canvasWidth=this.config.width+(this.cw-this.config.width%this.cw)),this.config.height%this.cw!=0&&(this.canvasHeight=this.config.height+(this.cw-this.config.height%this.cw)),this.cpw=Math.floor(this.canvasWidth/this.cw),this.cph=Math.floor(this.canvasHeight/this.cw),this.timer=[],this.score,this.fallenCount,this.speed=20,this.level,this.processing=!1,this.masks={0:{xy:[[0,1,0],[1,1,1]]},1:{xy:[[1,1],[1,1]]},2:{xy:[[1,1,0],[0,1,1]]},3:{xy:[[1,0,0],[1,1,1]]},4:{xy:[[1,1,1,1]]},5:{xy:[[1,0,1],[1,1,1]]},6:{xy:[[1,1,1],[1,0,1],[1,1,1]]},7:{xy:[[1,0,1],[1,0,1],[1,1,1]]},8:{xy:[[1,1,1],[0,1,0],[1,1,1]]},9:{xy:[[0,1,0],[1,1,1],[0,1,0]]},10:{xy:[[0,1,1],[1,1,0],[0,1,1]]},11:{xy:[[0,1,0],[0,1,0],[1,1,1]]},9:{xy:[[1,1,1,1,1]]},10:{xy:[[1,1,1,1,1,1]]},12:{xy:[[0,1,1,0],[1,1,1,1],[1,1,1,1],[0,1,1,0]]},13:{xy:[[1,1,1,1],[1,0,0,1],[1,0,0,1],[1,1,1,1]]},14:{xy:[[0,0,0,1],[0,0,1,0],[0,1,0,0],[1,0,0,0]]},15:{xy:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,0,0,0]]},16:{xy:[[0,0,1,0,0],[0,1,1,1,0],[1,1,1,1,1],[0,1,1,1,0],[0,0,1,0,0]]},17:{xy:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]]},18:{xy:[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,0],[1,1,1,1,1]]},19:{xy:[[1,0,1,0,1],[0,1,0,1,0],[1,0,1,0,1],[0,1,0,1,0],[1,1,1,1,1]]},20:{xy:[[1,1,1,1]]}},this.canvasField=[],this.fallingPiece=[],this.nextPiece=!1;var t=i.canvasWidth>i.canvasHeight?i.canvasHeight:i.canvasWidth;t-=50,this.theme=1,this.themePath=this.config.root+"img/themes/"+this.theme+"/";var a="wrap_"+this.getRandomInt(1,99999);this.$elem.wrap("<div id='"+a+"'></div>"),a="#"+a,this.$elem.prepend("<style>"+a+" .gameDiv{ position:relative; }"+a+" .canvasDiv{ background: #DDD; background-size: "+i.canvasWidth+"px "+i.canvasHeight+"px; position:relative; width: "+this.canvasWidth+"px; height: "+this.canvasHeight+"px;   }"+a+" .canvasDivBg{ background-image: url("+i.themePath+"brick_empty.png); background-size: "+i.cw+"px "+i.cw+"px; }"+a+" .gameInfo{ position:absolute; top:0; left:0; margin-left:-85px; }"+a+" .gamePause{ cursor:pointer;  }"+a+" .gamePause:hover{ cursor:pointer; color:#FFF; background: #000; }"+a+" .player{ margin-bottom:5px; font-size:10px; width:80px; display:block; overflow:hidden; }"+a+" .infoPlayer, .points, .lives{ padding:3px; margin:3px; color: #FFF;}"+a+" .points, .lives{ font-size:8px; text-align:right; background: black;}"+a+" .pausePlayer, .destroyPlayer{ color:#FFF; cursor:pointer;margin-left:5px; }"+a+" .menu{ z-index:9999; position: absolute; margin:auto; background:orange; width: "+t+"px; height: "+t+"px; top:0; bottom:0; left:0; right:0; }"+a+" .menu .menuHead{ padding:5px 10px; background:green; color:white }"+a+" .menu .menuBody{ padding: 4% 4%;  height: 92%; width: 92%;  overflow:hidden; }"+a+" .menu .menuBodyInner{ height: 88%; width: 100%; overflow:auto;  }"+a+" .menu .menuBack{ text-align:center; padding:5px; margin: 0 auto; width:100px; background:green; color:white;  }"+a+" .menu .menuBack:hover{  cursor:pointer;}"+a+" .menu .menuHtml{  display:none;  }"+a+" .menu .menuHtml table{  margin:0;  }"+a+" .menu .menuHtml table tr{  background:none;  }"+a+" .menu .menuHtml table td{  border:none;  }"+a+" .menu .menuHtmlInner{  padding:10px 0; border-bottom:1px solid green; border-top:1px solid green; }"+a+" .menu .menuTitle:hover{  cursor:pointer; text-decoration:underline}"+a+" .menu .menuTitleActive { padding:5px 10px; background:green; color:white; }"+a+" .menu .menuTitleActive:hover {  text-decoration:none }"+a+" .pt{float:left; width: "+i.cw+"px; height: "+i.cw+"px; background-image: url("+i.themePath+"brick_empty.png); background-size: "+i.cw+"px "+i.cw+"px; 	  filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.themePath+"brick_empty.png',sizingMethod='scale') !important; 	  -ms-filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\""+i.themePath+'brick_empty.png",sizingMethod="scale")\' !important; }'+a+" .c0{background-image:url("+i.themePath+"brick_empty.png) !important; 	  filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.themePath+"brick_empty.png',sizingMethod='scale') !important; 	  -ms-filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\""+i.themePath+'brick_empty.png",sizingMethod="scale")\' !important; }'+a+" .c1{background-image:url("+i.themePath+"brick_full.png) !important; 	  filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.themePath+"brick_full.png',sizingMethod='scale') !important; 	  -ms-filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\""+i.themePath+'brick_full.png",sizingMethod="scale")\' !important; }'+a+" .c2{background-image:url("+i.themePath+"wall.jpg) !important; 	  filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.themePath+"wall.png',sizingMethod='scale') !important; 	  -ms-filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\""+i.themePath+'wall.png",sizingMethod="scale")\' !important; }'+a+" .c3{background-image:url("+i.themePath+"running.png) !important; 	  filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.themePath+"running.png',sizingMethod='scale') !important; 	  -ms-filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\""+i.themePath+'running.png",sizingMethod="scale")\' !important; }'+a+" .c4{background-image:url("+i.themePath+"move.png) !important; 	  filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.themePath+"move.png',sizingMethod='scale') !important; 	  -ms-filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\""+i.themePath+'move.png",sizingMethod="scale")\' !important; }'+a+" .c5{background-image:url("+i.themePath+"move_not.png) !important; 	  filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.themePath+"move_not.png',sizingMethod='scale') !important; 	  -ms-filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\""+i.themePath+'move_not.png",sizingMethod="scale")\' !important; }'+a+" .c6{background-image:url("+i.themePath+"rotate1.png) !important; 	  filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.themePath+"rotate1.png',sizingMethod='scale') !important; 	  -ms-filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\""+i.themePath+'rotate1.png",sizingMethod="scale")\' !important; }'+a+" .c7{background-image:url("+i.themePath+"rotate2.png) !important; 	  filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.themePath+"rotate2.png',sizingMethod='scale') !important; 	  -ms-filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\""+i.themePath+'rotate2.png",sizingMethod="scale")\' !important; }'+a+" .c8{background-image:url("+i.themePath+"rotate3.png) !important; 	  filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.themePath+"rotate3.png',sizingMethod='scale') !important; 	  -ms-filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\""+i.themePath+'rotate3.png",sizingMethod="scale")\' !important; }'+a+" .c9{background-image:url("+i.themePath+"rotate4.png) !important; 	  filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.themePath+"rotate4.png',sizingMethod='scale') !important; 	  -ms-filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\""+i.themePath+'rotate4.png",sizingMethod="scale")\' !important; }'+a+" .c10{background-image:url("+i.themePath+"rotate_not.png) !important; 	   filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.themePath+"rotate_not.png',sizingMethod='scale') !important; 	   -ms-filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\""+i.themePath+'rotate_not.png",sizingMethod="scale")\' !important; }</style>');var n="";return n+="<div class=gameDiv>",n+="<div class=canvasDiv>",n+="</div>",n+="<div class=gameInfo>",n+="</div>",n+="</div>",this.$elem.append(n),this.isPaused=!0,this.isRunning=!1,this.toggleMenu(),this.setLoop(),this._initEvents(),this},_parseInt:function(e){var i=parseInt(e);return i?i:!1},menuItem:function(e,i,t,a,n){var s="";return n=n?" "+n:"",s+="<div class='menuItem"+n+"' data-action='"+t+"'>",s+="<div class='menuTitle'>",s+=i,s+="</div>",s+=e,s+="<div class='menuHtml'>",s+="<div class='menuHtmlInner'>",s+=a,s+="</div>",s+="<div class='menuBack'>Späť</div>",s+="</div>",s+="</div>"},menuItems:function(e){for(var i="<div class='menuItems'>",t=0;t<e.length;t++){var a="";e[t].items&&e[t].items.length>0&&(a=this.menuItems(e[t].items));var n="",s="",r="";e[t].action&&(n=e[t].action),e[t].html&&(s=e[t].html),e[t].cls&&(r=e[t].cls),i+=this.menuItem(a,e[t].title,n,s,r)}return i+="</div>"},menuTpl:function(e,i,t,a){var n="";return n+="<div class='menu menu"+a+"'>",n+="<div class='menuHead'>",n+=e,t&&(n+="<div class='menuBack'>Späť</div>"),n+="</div>",n+="<div class='menuBody'>",n+="<div class='menuBodyInner'>",n+=i,n+="</div>",n+="</div>",n+="</div>"},renderSelect:function(e,i,t){var a,n,s="";s+="<select class='"+e+"'>";for(var r=0;r<i.length;r++)n=i[r].id,a="",t==n&&(a="selected"),s+="<option data-id='"+n+"' "+a+">",s+=i[r].text,s+="</option>";return s+="</select>"},toggleMenu:function(){var i=this;if(i.$elem.find(".menu").length>0)i.$elem.find(".menu").is(":hidden")?i.$elem.find(".menu").show():i.$elem.find(".menu").hide();else{for(var t=[{title:"Nová hra",action:1},{title:"Pokračovať v hre",action:2},{title:"Ovládanie hry",html:"<ul><li>LEFT posun vľavo</li><li>RIGHT posun vpravo</li><li>UP rotácia </li><li>DOWN zrýchlenie </li></ul>"},{title:"Nastavenia",html:"<table class='settings'><tr> <td>Rýchlosť hry</td> <td>"+this.renderSelect("gameSpeed",[{id:50,text:"slimačia"},{id:20,text:"pomalá"},{id:15,text:"stredná"},{id:10,text:"rýchla"},{id:5,text:"megarýchla"},{id:3,text:"urýchľovač častíc"},{id:1,text:"rýchlosť svetla"}],this.config.gameSpeed)+" </td>   </tr> </table>"},{title:"Pravidlá",html:"Bloky skladajúce sa zo štvorčekov, padajú po obrazovke a hráč ich ukladá do múru od dolného konca hracej plochy. Keď je riadok plný štvorčekov bez dier, zmizne. Hráč sa snaží čo najďalej odmazávať riadky. Hra končí, keď múr dosiahne horný okraj hracej plochy."},{title:"O hre",html:"Tetris je počítačová hra, ktorú vyvinul sovietsky vedec Alexej Pažitnov, keď pracoval na moskovskej Akadémii vied Sovietskeho zväzu, inšpirovaný stolnou hrou pentomino. Verejnosti bola hra predstavená 6. júna 1984. Slovo Tetris pochádza z gréckeho slova tetra, teda štyri."}],a=i.menuItems(t),n=i.menuTpl("Hlavné menu",a,!1,0),s=0;s<t.length;s++);var r=e(n);i.$elem.find(".canvasDiv").append(r),r.hide().fadeIn(500)}i.isRunning?i.$elem.find('.menuItems .menuItem[data-action="2"]').show():i.$elem.find('.menuItems .menuItem[data-action="2"]').hide()},_initEvents:function(){function i(e){e==r.LEFT||e==r.A?a.movePiece(-1):e==r.RIGHT||e==r.D?a.movePiece(1):e==r.P?(a.isPaused=!a.isPaused,a.toggleMenu(!0)):e==r.ESC?a.createPiece(a.config.gameSpeed):e==r.UP||e==r.W?a.rotatePiece():(e==r.DOWN||e==r.S)&&a.fastMoving()}var a=this;e(t).keydown(function(e){var t=e.which;!a.isRunning||a.isPaused&&t!=r.P||(e.preventDefault(),i(t))}),a.$elem.on("click",".menuTitle",function(){{var i=e(this).closest(".menuItem"),t=i.data("action");i.data("html"),i.text()}t?"1"==t?(a.resetGame(),a.isPaused=!1,a.isRunning=!0):"2"==t?(a.isPaused=!1,a.toggleMenu(!0)):"3"==t&&(a.config.snakeCount=8,a.config.snakeCountAi=8,a.config.gameSpeed=1,a.config.allowGrowing=0,a.config.snakeLives=1e3,a.resetGame(),a.isPaused=!1,a.isRunning=!0):(e(".menuItem").hide(),i.show(),i.find(".menuHtml").fadeIn(500),i.find(".menuTitle").addClass("menuTitleActive"))}),a.$elem.on("click",".menuBack",function(){var i=e(this).closest(".menuItem");e(".menuItem").fadeIn(500),i.find(".menuHtml").hide(),i.find(".menuTitle").removeClass("menuTitleActive"),a.isRunning?a.$elem.find('.menuItems .menuItem[data-action="2"]').show():a.$elem.find('.menuItems .menuItem[data-action="2"]').hide()}),a.$elem.on("change","select",function(){var i=e(this),t=(i.val(),i.attr("class")),n=i.find(":selected").data("id");a.config[t]=1*n}),e(t).on("click",".settings button",function(){}),e(t).on("click",".newGame",function(){}),e(t).on("click",".resumeGame",function(){}),e(".ctrl2").click(function(){var t=e(this).data("key");i(t)}),s(".ctrl",function(e){var t=e.data("key");i(t)},100)},gameOver:function(){var e=this;e.isPaused=!0,e.isRunning=!1,e.$elem.find(".canvasDiv").html(""),e.$elem.find(".canvasDiv").removeClass("canvasDivBg"),e.toggleMenu()},fastMoving:function(){var e=this;e.fallingPiece.running?(e.fallingPiece.running=!1,e.fallingPiece.speed=e.speed,e.changePieceClass(1,!1)):(e.fallingPiece.speed=2,e.changePieceClass(3,!1),e.fallingPiece.running=!0)},resetGame:function(){this.score=0,this.fallenCount=0,this.level=1,this.frames=0,this.nextPiece=!1,this.createCanvas(),this.createPiece(this.config.gameSpeed);var e="";e+="<div>Spadlo <span class='fallenCount'>"+this.fallenCount+"</span></div>",e+="<div>Bodov <span class='score'>"+this.score+"</span></div>",e+="<div class='ctrl' data-key='37'>left</div>",e+="<div class='ctrl' data-key='38'>rotate</div>",e+="<div class='ctrl' data-key='39'>right</div>",e+="<div class='ctrl' data-key='40'>down</div>",e+="<div class='ctrl' data-key='80'>pause</div>",this.$elem.find(".gameInfo").html(e)},createCanvas:function(){var i=this;e("#tetris").html(""),this.$elem.find(".canvasDiv").html("");for(var t=3e3,a=0;a<this.cph;a++){this.canvasField[a]=[];for(var n=0;n<this.cpw;n++)ta=0,t-=5,(a==this.cph-1||0==n||n==this.cpw-1)&&(ta=2),this.canvasField[a][n]=ta,this.$elem.find(".canvasDiv").append("<div class='pt xy_"+n+"_"+a+" x"+n+" y"+a+"' ></div>"),this.$elem.find(".xy_"+n+"_"+a).hide().fadeIn(t)}i.$elem.find(".canvasDiv").removeClass("canvasDivBg"),clearTimeout(this.timer.canvasDiv),this.timer.canvasDiv=setTimeout(function(){i.$elem.find(".canvasDiv").addClass("canvasDivBg")},3e3)},setLoop:function(){var e,t=this;e=i.webkitRequestAnimationFrame?function(e){}:i.mozRequestAnimationFrame?function(e){}:function(){};var a=function(){return i.requestAnimationFrame||i.webkitRequestAnimationFrame||i.mozRequestAnimationFrame||i.oRequestAnimationFrame||i.msRequestAnimationFrame||function(e){i.setTimeout(e,1e3/60)}}();!function n(){t.isPaused||t.gameLoop(),a(n)}()},getRandomInt:function(e,i){return Math.floor(Math.random()*(i-e+1))+e},createPiece:function(i){this.fallenCount=this.fallenCount+1,this.$elem.find(".fallenCount").text(this.fallenCount);var t=4;this.fallenCount%10==0&&(this.level=this.level+1,e("#level").text(this.level),t+=Math.floor(this.fallenCount/10)),t>15&&(t=15),min_i=0,t=4,this.fallingPiece={},this.fallingPiece.xy=[],this.fallingPiece.running=!1,this.fallingPiece.mask=this.nextPiece?this.nextPiece:this.preparePieceMask(min_i,t),this.nextPiece=this.preparePieceMask(min_i,t),this.fallingPiece.w=this.fallingPiece.mask[0].length,this.fallingPiece.h=this.fallingPiece.mask.length,this.fallingPiece.r=1,this.fallingPiece.speed=i;for(var a=0;a<this.fallingPiece.mask.length;a++)for(var n=0;n<this.fallingPiece.mask[a].length;n++)1==this.fallingPiece.mask[a][n]&&this.fallingPiece.xy.push({x:n+6,y:a-1,m:1});this.fallingPiece.l=this.fallingPiece.xy.length},preparePieceMask:function(e,i){var t=this.getRandomInt(e,i),a=this.getRandomInt(0,3),n=this.masks[t].xy;switch(a){case 0:return n;case 1:return this.reverseArray(n);case 2:return this.transposeArray(n);default:return n=this.reverseArray(n),this.transposeArray(n)}},gameLoop:function(){var e=this;e.frames%e.fallingPiece.speed==0&&e.gameUpdate(),e.gameDraw(),e.frames++},gameUpdate:function(){var i=this;if(i.checkCollision(0,1)){if(i.processing)return;var t=(i.fallingPiece.xy[0].x,i.fallingPiece.xy[0].y);if(0>t)return void i.gameOver();for(var a=0;a<i.fallingPiece.l;a++){var n=i.fallingPiece.xy[a].x,s=i.fallingPiece.xy[a].y,r=i.fallingPiece.xy[a].m;r>0&&(r=1),i.canvasField[s][n]=r}for(var o=[],l=0;l<i.cph;l++)i.canvasField[l][1]>0&&2!=i.canvasField[l][1]&&i.canvasField[l].allValuesSame(1,i.cpw-1)&&o.push(l);o.length>0&&(i.processing=!0,e.each(o,function(i,t){e(".y"+t).not(".c2").fadeOut(1e3,function(){e(this).show()})}),setTimeout(function(){e.each(o,function(e,t){console.log("timeout: "+t),i.canvasField.splice(t,1);for(var a=[],n=0;n<i.cpw;n++)a[n]=0;a[0]=2,a[i.canvasField[0].length-1]=2,i.canvasField.unshift(a),i.score=i.score+1,i.$elem.find(".score").text(i.score),i.processing=!1})},1e3)),i.createPiece(i.config.gameSpeed)}else for(var a=0;a<i.fallingPiece.l;a++){{i.fallingPiece.xy[a]}i.fallingPiece.xy[a].y+=1}},gameDraw:function(){var e=this;e.$elem.find(".pt").removeClass(function(){for(var e="",i=this.className.split(" "),t=0;t<i.length;t++)/c\d/.test(i[t])&&(e+=i[t]+" ");return e});for(var i=0;i<e.cph;i++)for(var t=0;t<e.cpw;t++){var a=e.canvasField[i][t];a>0&&e.drawCell(t,i,a)}for(var i=0;i<e.fallingPiece.l;i++){var a=e.fallingPiece.xy[i];e.drawCell(a.x,a.y,e.fallingPiece.xy[i].m)}},drawCell:function(e,i,t){this.$elem.find(".xy_"+e+"_"+i).addClass("c"+t)},rotatePiece:function(){sw=this.fallingPiece.w,sh=this.fallingPiece.h;var e=this.getRandomInt(0,2),i=1;i=0==e?4:1==e?3:1,i=this.fallingPiece.xy[0].m,mx=this.getMin("x"),my=this.getMin("y"),pivx=pivx2=mx,pivy=pivy2=my,mm=sw,sh>sw?(pivx=mx-Math.floor(sh/2)+1,pivy=my+Math.floor(sh/2),mm=sh,pivx2=pivx):sh<sw&&(pivx=mx+Math.floor(sw/2)-1,pivy=my-Math.floor(sw/2),pivy2=pivy);for(var t=pivy2;t<mm+pivy2;t++)for(var a=pivx2;a<mm+pivx2;a++)if(this.canvasField[t]&&0!=this.canvasField[t][a])return this.changePieceClass(10,500),!1;this.fallingPiece.xy=[],this.fallingPiece.mask=this.transposeArray(this.fallingPiece.mask),this.fallingPiece.mask=this.reverseArray(this.fallingPiece.mask),this.fallingPiece.r=this.fallingPiece.r+1,this.fallingPiece.r>4&&(this.fallingPiece.r=1);for(var t=0;t<this.fallingPiece.mask.length;t++)for(var a=0;a<this.fallingPiece.mask[t].length;a++)console.log(pivy+" - "+pivx),1==this.fallingPiece.mask[t][a]&&this.fallingPiece.xy.push({x:a+pivx,y:t+pivy,m:i});this.fallingPiece.w=sh,this.fallingPiece.h=sw,this.changePieceClass(this.fallingPiece.r+5,500)},transposeArray:function(e){var i=e.length?e.length:0,t=e[0]instanceof Array?e[0].length:0;if(0===t||0===i)return[];var a,n,s=[];for(a=0;t>a;a++)for(s[a]=[],n=0;i>n;n++)s[a][n]=e[n][a];return s},reverseArray:function(e){for(var i=[],t=0;t<e.length;t++)i.push([]);for(var t=0;t<e.length;t++)i[t]=e[t].reverse();return i},checkCollision:function(e,i){for(var t=0;t<this.fallingPiece.l;t++)if(x=this.fallingPiece.xy[t].x+e,y=this.fallingPiece.xy[t].y+i,this.canvasField[y]&&this.canvasField[y][x]>0)return!0;return!1},getMin:function(e){for(var i=this.fallingPiece.xy[0][e],t=0;t<this.fallingPiece.l;t++)i>this.fallingPiece.xy[t][e]&&(i=this.fallingPiece.xy[t][e]);return i},movePiece:function(e){if(this.checkCollision(e,0))this.changePieceClass(5,500);else{for(var i=(this.fallingPiece,0);i<this.fallingPiece.l;i++)x=this.fallingPiece.xy[i].x,y=this.fallingPiece.xy[i].y,this.fallingPiece.xy[i].x=this.fallingPiece.xy[i].x+e;this.changePieceClass(4,500)}},changePieceClass:function(e,i){var t=this;this.fallingPiece.running&&(e=3,i=!1);for(var a=0;a<this.fallingPiece.l;a++)this.fallingPiece.xy[a].m=e;i&&(clearTimeout(this.timer.changePieceClass),this.timer.changePieceClass=setTimeout(function(){for(var e=0;e<t.fallingPiece.l;e++)t.fallingPiece.running||(t.fallingPiece.xy[e].m=1)},i))}},e.fn[o]=function(i){var t=arguments;if(i===a||"object"==typeof i)return this.each(function(){e.data(this,"plugin_"+o)||e.data(this,"plugin_"+o,new n(this,i))});if("string"==typeof i&&"_"!==i[0]&&"init"!==i){var s;return this.each(function(){var a=e.data(this,"plugin_"+o);a instanceof n&&"function"==typeof a[i]&&(s=a[i].apply(a,Array.prototype.slice.call(t,1))),"destroy"===i&&e.data(this,"plugin_"+o,null)}),s!==a?s:this}}}(jQuery,window,document);